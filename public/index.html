<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Assistant di Manuel</title>
  <style>
    /* ... [stili identici o migliorati, vedi suggerimenti precedenti] ... */
    /* Vedi sotto per i dettagli, puoi riutilizzare i tuoi ma puliti */
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="messages" id="messages">
      <div class="message bot" id="welcome-message"></div>
    </div>
    <form class="input-area" id="chat-form" autocomplete="off">
      <input type="text" id="user-input" placeholder="Scrivi un messaggio..." autocomplete="off" aria-label="Scrivi un messaggio" required />
      <button id="send-button" type="submit">Invia</button>
    </form>
  </div>
  <script type="module">
    const messagesContainer = document.getElementById('messages');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const chatForm = document.getElementById('chat-form');

    // Messaggio contestualizzato
    document.getElementById('welcome-message').innerHTML = `
      ðŸ‘‹ Ciao! Sono lâ€™assistente digitale di Manuel.<br>
      in un mondo di AI dove tutti i CV si sono uniformati,il mio a padrone ha deciso di fare qualcosa che rende uniformi per distinguersi, ho accesso ai suoi ricordi chiedimi pure quello che vuoi.<br><br>
      <small>(Nota: i dati restano privati e sicuri. Usa la chat per ogni domanda.)</small>
    `;

    function appendMessage(text, sender) {
      const message = document.createElement('div');
      message.classList.add('message', sender);
      message.textContent = text;
      messagesContainer.appendChild(message);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      return message;
    }

    // Loading "pensiero"
    function showThinking() {
      const thinking = document.createElement('div');
      thinking.className = 'message thinking';
      thinking.innerHTML = `<span>Sto pensando...</span>`;
      messagesContainer.appendChild(thinking);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      return thinking;
    }

    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = userInput.value.trim();
      if (!text) return;
      appendMessage(text, 'user');
      userInput.value = '';
      userInput.disabled = true;
      sendButton.disabled = true;

      const thinkingMsg = showThinking();
      try {
        const response = await fetch('/.netlify/functions/gptHandler', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text })
        });
        const data = await response.json();
        thinkingMsg.remove();
        appendMessage(data.reply || "Nessuna risposta disponibile.", 'bot');
      } catch (error) {
        thinkingMsg.remove();
        appendMessage("Errore di connessione. Riprova tra poco.", 'bot');
      }
      userInput.disabled = false;
      sendButton.disabled = false;
      userInput.focus();
    });

    userInput.focus();
  </script>
</body>
</html>
